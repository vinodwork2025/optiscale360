<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Configuration - OptiScale 360</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">üîß GitHub Configuration</h1>
            <p class="text-xl text-gray-600">Set up GitHub integration for one-click publishing to Cloudflare Pages</p>
        </div>

        <!-- Configuration Form -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <div id="configForm">
                <h2 class="text-2xl font-semibold mb-6">GitHub Settings</h2>

                <div class="space-y-6">
                    <!-- GitHub Token -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            GitHub Personal Access Token *
                        </label>
                        <input type="password" id="githubToken"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                        <p class="text-sm text-gray-500 mt-2">
                            Create at: <a href="https://github.com/settings/tokens" target="_blank" class="text-blue-600 hover:underline">GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens</a>
                            <br>Required scopes: <code class="bg-gray-100 px-1 rounded">repo</code>
                        </p>
                    </div>

                    <!-- Repository Owner -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Repository Owner *
                        </label>
                        <input type="text" id="repoOwner" value="vinodwork2025"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="your-github-username">
                    </div>

                    <!-- Repository Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Repository Name *
                        </label>
                        <input type="text" id="repoName" value="optiscale360"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="your-repo-name">
                    </div>

                    <!-- Branch -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Branch
                        </label>
                        <input type="text" id="repoBranch" value="main"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="main">
                    </div>
                </div>

                <div class="flex gap-4 mt-8">
                    <button onclick="testConnection()"
                            class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        üîó Test Connection
                    </button>
                    <button onclick="saveConfiguration()"
                            class="flex-1 px-6 py-3 gradient-bg text-white rounded-lg hover:opacity-90 transition-opacity font-medium">
                        üíæ Save Configuration
                    </button>
                </div>
            </div>

            <!-- Status Messages -->
            <div id="statusMessages" class="mt-6 hidden"></div>
        </div>

        <!-- Instructions -->
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-semibold mb-6">üìö Setup Instructions</h2>

            <div class="space-y-6">
                <div class="p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <h3 class="font-semibold text-blue-800 mb-2">Step 1: Create GitHub Personal Access Token</h3>
                    <ol class="list-decimal list-inside text-blue-700 space-y-1">
                        <li>Go to <a href="https://github.com/settings/tokens" target="_blank" class="underline">GitHub Settings ‚Üí Personal access tokens</a></li>
                        <li>Click "Generate new token (classic)"</li>
                        <li>Give it a name like "OptiScale 360 Blog Publisher"</li>
                        <li>Select the <code class="bg-blue-100 px-1 rounded">repo</code> scope (full control of private repositories)</li>
                        <li>Click "Generate token" and copy the token</li>
                    </ol>
                </div>

                <div class="p-4 bg-green-50 border-l-4 border-green-400 rounded">
                    <h3 class="font-semibold text-green-800 mb-2">Step 2: Configure Repository Details</h3>
                    <ul class="list-disc list-inside text-green-700 space-y-1">
                        <li><strong>Owner:</strong> Your GitHub username (e.g., "vinodwork2025")</li>
                        <li><strong>Repository:</strong> Your repository name (e.g., "optiscale360")</li>
                        <li><strong>Branch:</strong> Usually "main" or "master"</li>
                    </ul>
                </div>

                <div class="p-4 bg-purple-50 border-l-4 border-purple-400 rounded">
                    <h3 class="font-semibold text-purple-800 mb-2">Step 3: Cloudflare Pages Auto-Deployment</h3>
                    <p class="text-purple-700">
                        Once configured, every blog post publish will automatically:
                    </p>
                    <ul class="list-disc list-inside text-purple-700 mt-2 space-y-1">
                        <li>Commit files to your GitHub repository</li>
                        <li>Trigger Cloudflare Pages automatic deployment</li>
                        <li>Make your post live within 30-60 seconds</li>
                    </ul>
                </div>

                <div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                    <h3 class="font-semibold text-yellow-800 mb-2">Security Note</h3>
                    <p class="text-yellow-700">
                        Your GitHub token is stored locally in your browser and never sent to external servers.
                        Only you have access to it, and it's used only for publishing to your own repository.
                    </p>
                </div>
            </div>

            <div class="mt-8 text-center">
                <button onclick="window.close()"
                        class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                    ‚Üê Back to Blog Creator
                </button>
            </div>
        </div>
    </div>

    <script src="./github-publisher.js"></script>
    <script>
        let publisher = new GitHubPublisher();

        // Load existing configuration
        window.addEventListener('DOMContentLoaded', () => {
            loadConfiguration();
        });

        function loadConfiguration() {
            const token = localStorage.getItem('github_token');
            const owner = localStorage.getItem('github_owner') || 'vinodwork2025';
            const repo = localStorage.getItem('github_repo') || 'optiscale360';
            const branch = localStorage.getItem('github_branch') || 'main';

            if (token) {
                document.getElementById('githubToken').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
            }
            document.getElementById('repoOwner').value = owner;
            document.getElementById('repoName').value = repo;
            document.getElementById('repoBranch').value = branch;

            if (token) {
                showStatus('‚úÖ GitHub token is configured', 'success');
            }
        }

        async function testConnection() {
            const token = document.getElementById('githubToken').value;
            const owner = document.getElementById('repoOwner').value;
            const repo = document.getElementById('repoName').value;
            const branch = document.getElementById('repoBranch').value;

            if (!token || token === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                showStatus('‚ùå Please enter your GitHub token', 'error');
                return;
            }

            if (!owner || !repo) {
                showStatus('‚ùå Please fill in repository owner and name', 'error');
                return;
            }

            showStatus('üîÑ Testing connection...', 'info');

            // Configure publisher with new settings
            publisher.configure(token, owner, repo, branch);

            const result = await publisher.testConnection();

            if (result.success) {
                showStatus(`‚úÖ ${result.message}`, 'success');
                showStatus(`üìä Repository: ${result.repo.full_name} (${result.repo.visibility})`, 'info');
            } else {
                showStatus(`‚ùå ${result.message}`, 'error');
            }
        }

        function saveConfiguration() {
            const token = document.getElementById('githubToken').value;
            const owner = document.getElementById('repoOwner').value;
            const repo = document.getElementById('repoName').value;
            const branch = document.getElementById('repoBranch').value;

            if (!token || token === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                const existingToken = localStorage.getItem('github_token');
                if (!existingToken) {
                    showStatus('‚ùå Please enter your GitHub token', 'error');
                    return;
                }
            }

            if (!owner || !repo) {
                showStatus('‚ùå Please fill in repository owner and name', 'error');
                return;
            }

            // Use existing token if not changed
            const finalToken = (token === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') ?
                localStorage.getItem('github_token') : token;

            publisher.configure(finalToken, owner, repo, branch);

            showStatus('‚úÖ Configuration saved successfully!', 'success');

            setTimeout(() => {
                showStatus('üí° You can now use "Publish to GitHub" in the blog creator', 'info');
            }, 1500);
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessages');
            statusDiv.classList.remove('hidden');

            const colors = {
                success: 'bg-green-100 border-green-300 text-green-800',
                error: 'bg-red-100 border-red-300 text-red-800',
                info: 'bg-blue-100 border-blue-300 text-blue-800'
            };

            const statusMessage = document.createElement('div');
            statusMessage.className = `p-3 border rounded-lg ${colors[type] || colors.info} mb-2`;
            statusMessage.innerHTML = message;

            statusDiv.appendChild(statusMessage);

            // Auto-remove after 5 seconds for non-error messages
            if (type !== 'error') {
                setTimeout(() => {
                    if (statusMessage.parentNode) {
                        statusMessage.remove();
                    }
                }, 5000);
            }

            statusDiv.scrollTop = statusDiv.scrollHeight;
        }
    </script>
</body>
</html>